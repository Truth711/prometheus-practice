# Prometheus Practice

## Оглавление
- [Описание](#описание)
- [Проверка работоспособности](#проверка-работоспособности)
- [Запуск](#запуск)
- [Задача](#задача)

## Описание
Данный репозиторий содержит мою реализацию практического задания по мониторингу и логированию с использованием Prometheus и стека EFK. Основная цель проекта — закрепление материала курса и получение практического опыта развертывания и настройки систем мониторинга.

## Проверка работоспособности
Тестирование проводилось на следующем окружении:

- **Операционная система:** Windows 10 x64 Pro
- **Среда выполнения:**
  - Vagrant 2.4.0
  - VirtualBox 6.1.48

## Запуск

1. Склонируйте репозиторий:  
   ```bash
   git clone https://github.com/Truth711/prometheus_practicum.git
   ```
2. Перейдите в папку проекта:  
   ```bash
   cd ./prometheus_practicum
   ```
3. Запустите виртуальные машины:  
   ```bash
   vagrant up
   ```
4. Подключитесь к контрольной машине:  
   ```bash
   vagrant ssh controlnode
   ```
5. Для пользователей Windows: скопируйте папку ansible и переименуйте её в internal_ansible, затем установите необходимые права:  
   ```bash
   cp -R ansible internal_ansible
   chmod -R 775 internal_ansible
   ```
6. Перейдите в папку ansible (или internal_ansible для Windows):  
   ```bash
   cd internal_ansible/
   ```
7. Запустите плейбук Ansible:  
   ```bash
   ansible-playbook playbook.yml
   ```

## Задача
Цель: подготовить Ansible-роли для развертывания Prometheus и его экспортеров, а также стека логирования EFK (Elasticsearch + Fluentbit + Kibana).

### Необходимо:
1. **Развернуть Prometheus** (вне кластера Kubernetes) с настройкой мониторинга внешних хостов.
2. **Настроить Node Exporter** и добавить его в конфигурацию Prometheus.
3. **Развернуть стек логирования ElasticSearch + Kibana**.
4. **Настроить Fluentbit** для сбора системных логов и передачи их в ElasticSearch.

### Описание ролей

#### Роль: Prometheus
- Устанавливает и настраивает Prometheus
- Добавляет systemd unit для запуска сервиса
- Создаёт пользователей, директории и задаёт права
- Настраивает мониторинг самого Prometheus
- Перезапускает сервис при изменении конфигурации

#### Роль: Node Exporter
- Устанавливает Node Exporter
- Добавляет systemd unit для запуска сервиса
- Создаёт пользователей, директории и задаёт права
- Добавляет хост в конфигурацию Prometheus через static_config
- Обновляет конфигурацию Prometheus без конфликтов
- Перезапускает Prometheus при изменении конфигурации

#### Роль: ElasticSearch + Kibana
- Устанавливает ElasticSearch
- Устанавливает Kibana
- Добавляет systemd unit-файлы для запуска
- Создаёт пользователей, директории и задаёт права
- Запускает сервисы

#### Роль: FluentBit
- Устанавливает FluentBit
- Добавляет systemd unit-файл
- Создаёт пользователей, директории и задаёт права
- Настраивает сбор логов из journald и отправку в ElasticSearch
- Запускает сервис
